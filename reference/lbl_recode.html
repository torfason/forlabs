<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="These functions recode labelled variables while taking special care to keep
the values and the labels (a.k.a. value labels) of the variable in sync.
They assume that the value labels are meaningfully related to the values, so
when recoding values, the functions take care to recode the levels of the
value labels  so that the labels continue to track the underlying values.
For recoding using formula or tilde notation, the underlying recoding
takes place using dplyr::case_match(), and for recoding using a lookup
table (provided either as a named vector/list or as a data.frame) is
done using zmisc::lookup(). Both methods can be used in the same call, in
that case the formula notation is applied first, followed by the
application of the lookup table.
lbl_recode() does the recode operation on the values but updates the
levels of the value labels accordingly. This is appropriate before using the
variable for plots or statistical analyses. Recoding multiple values to the
same value results in corresponding variable labels being combined. Recoding
to NA results in corresponding labels to be dropped since NA should not
be labelled in standard haven_labelled variables.
lbl_recode_values() is an alias for lbl_recode(), but makes it explicit
that focal target of the recoding is the underlying values in the labelled
variable.
lbl_recode_labels() recodes the text description of the labels attached to the
labelled variable, leaving the underlying values unchanged. This is appropriate to do before
using the variable in functions that display the labels, in particular if the output is intended
for a final product or publication."><title>Recode labelled variables using either formula notation or lookup tables — lbl_recode • forlabs</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Recode labelled variables using either formula notation or lookup tables — lbl_recode"><meta property="og:description" content="These functions recode labelled variables while taking special care to keep
the values and the labels (a.k.a. value labels) of the variable in sync.
They assume that the value labels are meaningfully related to the values, so
when recoding values, the functions take care to recode the levels of the
value labels  so that the labels continue to track the underlying values.
For recoding using formula or tilde notation, the underlying recoding
takes place using dplyr::case_match(), and for recoding using a lookup
table (provided either as a named vector/list or as a data.frame) is
done using zmisc::lookup(). Both methods can be used in the same call, in
that case the formula notation is applied first, followed by the
application of the lookup table.
lbl_recode() does the recode operation on the values but updates the
levels of the value labels accordingly. This is appropriate before using the
variable for plots or statistical analyses. Recoding multiple values to the
same value results in corresponding variable labels being combined. Recoding
to NA results in corresponding labels to be dropped since NA should not
be labelled in standard haven_labelled variables.
lbl_recode_values() is an alias for lbl_recode(), but makes it explicit
that focal target of the recoding is the underlying values in the labelled
variable.
lbl_recode_labels() recodes the text description of the labels attached to the
labelled variable, leaving the underlying values unchanged. This is appropriate to do before
using the variable in functions that display the labels, in particular if the output is intended
for a final product or publication."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">forlabs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/torfason/forlabs/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Recode labelled variables using either formula notation or lookup tables</h1>
      <small class="dont-index">Source: <a href="https://github.com/torfason/forlabs/blob/HEAD/R/recode.R" class="external-link"><code>R/recode.R</code></a></small>
      <div class="d-none name"><code>lbl_recode.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>These functions recode labelled variables while taking special care to keep
the <em>values</em> and the <em>labels</em> (a.k.a. value labels) of the variable in sync.
They assume that the value labels are meaningfully related to the values, so
when recoding values, the functions take care to recode the levels of the
value labels  so that the labels continue to track the underlying values.</p>
<p>For recoding using <code>formula</code> or <code>tilde</code> notation, the underlying recoding
takes place using <code><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">dplyr::case_match()</a></code>, and for recoding using a lookup
table (provided either as a named <code>vector</code>/<code>list</code> or as a <code>data.frame</code>) is
done using <code><a href="https://torfason.github.io/zmisc/reference/lookup.html" class="external-link">zmisc::lookup()</a></code>. Both methods can be used in the same call, in
that case the <code>formula</code> notation is applied first, followed by the
application of the lookup table.</p>
<p><code>lbl_recode()</code> does the recode operation on the <em>values</em> but updates the
levels of the value labels accordingly. This is appropriate before using the
variable for plots or statistical analyses. Recoding multiple values to the
same value results in corresponding variable labels being combined. Recoding
to <code>NA</code> results in corresponding labels to be dropped since <code>NA</code> should not
be labelled in standard <code>haven_labelled</code> variables.</p>
<p><code>lbl_recode_values()</code> is an alias for <code>lbl_recode()</code>, but makes it explicit
that focal target of the recoding is the underlying values in the <code>labelled</code>
variable.</p>
<p><code>lbl_recode_labels()</code> recodes the <em>text description</em> of the labels attached to the
<code>labelled</code> variable, leaving the underlying values unchanged. This is appropriate to do before
using the variable in functions that display the labels, in particular if the output is intended
for a final product or publication.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">lbl_recode</span><span class="op">(</span><span class="va">.x</span>, <span class="va">...</span>, .lookup_table <span class="op">=</span> <span class="cn">NULL</span>, .sep <span class="op">=</span> <span class="st">" / "</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lbl_recode_values</span><span class="op">(</span><span class="va">.x</span>, <span class="va">...</span>, .lookup_table <span class="op">=</span> <span class="cn">NULL</span>, .sep <span class="op">=</span> <span class="st">" / "</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lbl_recode_labels</span><span class="op">(</span><span class="va">.x</span>, <span class="va">...</span>, .lookup_table <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>.x</dt>
<dd><p>The <code>labelled</code> vector to recode.</p></dd>


<dt>...</dt>
<dd><p>A recode specification in <code>tilde</code> (<code>formula</code>) syntax. See
<code><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">dplyr::case_match()</a></code> for specifics about the format of the parameter.</p></dd>


<dt>.lookup_table</dt>
<dd><p>A recode specification in the form of a lookup table.
See <code><a href="https://torfason.github.io/zmisc/reference/lookup.html" class="external-link">zmisc::lookup()</a></code> for specifics about the format of the parameter.</p></dd>


<dt>.sep</dt>
<dd><p>A string for how to separate labels that need to be combined.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>The re-coded vector.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu">lbl_recode</span><span class="op">(</span><span class="va">fruit_lbl</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span> <span class="op">~</span> <span class="fl">1</span>, <span class="fl">3</span> <span class="op">~</span> <span class="fl">2</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">5</span> <span class="op">~</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;labelled&lt;double&gt;[50]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 2 3 3 2 1 1 1 3 1 1 1 1 3 3 1 3 3 3 1 1 2 3 3 3 3 1 1 2 1 2 1 2 1 1 3 2 3 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [39] 2 1 1 1 3 3 1 3 2 1 3 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Labels:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  value          label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      1 Apple / Banana</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      2           Lime</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      3 Orange / Peach</span>
<span class="r-in"><span><span class="fu">lbl_recode</span><span class="op">(</span><span class="va">fruit_lbl_chr</span>, <span class="st">"d"</span> <span class="op">~</span> <span class="st">"z"</span>, <span class="st">"e"</span> <span class="op">~</span> <span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;labelled&lt;character&gt;[50]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] c  NA z  c  a  b  a  z  a  a  b  a  NA z  b  NA NA z  b  b  c  z  NA NA z </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] b  b  c  b  c  a  c  b  a  z  c  z  z  c  a  b  b  z  NA b  NA c  a  NA a </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Labels:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  value  label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      a  Apple</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      b Banana</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      c   Lime</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      z Orange</span>
<span class="r-in"><span><span class="fu">lbl_recode</span><span class="op">(</span><span class="va">fruit_lbl_chr</span>, .lookup_table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="st">"b"</span>, e <span class="op">=</span> <span class="st">"d"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;labelled&lt;character&gt;[50]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] c d d c b b b d b b b b d d b d d d b b c d d d d b b c b c b c b b d c d d</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [39] c b b b d d b d c b d b</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Labels:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  value          label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      b Apple / Banana</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      c           Lime</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      d Orange / Peach</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">exotic_recoded</span> <span class="op">&lt;-</span> <span class="fu">lbl_recode</span><span class="op">(</span><span class="va">exotic_veggies</span>,</span></span>
<span class="r-in"><span>                             <span class="fl">3</span><span class="op">:</span><span class="fl">10</span> <span class="op">~</span> <span class="fl">1</span>, <span class="fl">11</span><span class="op">:</span><span class="fl">20</span> <span class="op">~</span> <span class="fl">2</span>, <span class="fl">21</span><span class="op">:</span><span class="fl">41</span> <span class="op">~</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                             <span class="fl">2</span> <span class="op">~</span> <span class="cn">NA</span>, <span class="cn">NA</span> <span class="op">~</span> <span class="fl">99</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="lbl_count.html">lbl_count</a></span><span class="op">(</span><span class="va">exotic_recoded</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       v l                                                 n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>     1 Celeriac / Chayote / Eggplant                    16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>     2 Endive / Fennel / Jicama / Kohlrabi              17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>     3 Okra / Radicchio / Rutabaga / Taro / Zucchini     8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>    99 <span style="color: #BB0000;">NA</span>                                                1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span>    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>                                                8</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">lbl_recode_labels</span><span class="op">(</span><span class="va">veggies</span>,</span></span>
<span class="r-in"><span>    <span class="st">"Carrot"</span> <span class="op">~</span> <span class="st">"A straight underground veggie"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"Potato"</span> <span class="op">~</span> <span class="st">"A round underground veggie"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"Tomato"</span> <span class="op">~</span> <span class="st">"A round overground veggie"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"Cucumber"</span> <span class="op">~</span> <span class="st">"A (mostly) straight overground veggie"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;labelled&lt;double&gt;[50]&gt;: The regular veggies are indexed by the prime numbers 2-11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  5 11  2  7  3  5  7  5  2 11  3  2  7  3  5  7  3  2  2  2 11 11  2  2  3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26]  2 11  5  7  3 11  2 11  2  2  7  5  3  3  2  3 11  7  2  3  2  5  2  7  2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Labels:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  value                                 label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      2         A straight underground veggie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      3            A round underground veggie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      5             A round overground veggie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      7 A (mostly) straight overground veggie</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     11                              Broccoli</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">lbl_recode_labels</span><span class="op">(</span><span class="va">veggies</span>,</span></span>
<span class="r-in"><span>    .lookup_table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tomato"</span> <span class="op">=</span> <span class="st">"Tomaaato"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;labelled&lt;double&gt;[50]&gt;: The regular veggies are indexed by the prime numbers 2-11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  5 11  2  7  3  5  7  5  2 11  3  2  7  3  5  7  3  2  2  2 11 11  2  2  3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26]  2 11  5  7  3 11  2 11  2  2  7  5  3  3  2  3 11  7  2  3  2  5  2  7  2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Labels:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  value    label</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      2   Carrot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      3   Potato</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      5 Tomaaato</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      7 Cucumber</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     11 Broccoli</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Magnus Thor Torfason.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

